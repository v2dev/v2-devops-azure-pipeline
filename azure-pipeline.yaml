trigger:
  - main
 
pool:
  # vmImage: 'ubuntu-latest'*
  name: self-hosted-agent-pool

stages:
- stage: FetchKeyVaultSecrets
  displayName: 'Fetch Secrets from the vault'
  jobs:
  - job: FetchKeyVaultSecrets
    displayName: 'Fetch URLs from Azure Key Vault'
    steps:
    - task: AzureKeyVault@2
      inputs:
        azureSubscription: 'v2devop-wif'
        KeyVaultName: 'v2devops-new-test'
        # SecretsFilter: '*'
        RunAsPreJob: false
    - script: |
        echo "Container1 URL: $(Container1Url)"
        echo "Container2 URL: $(Container2Url)"
      displayName: 'Display fetched URLs'

  - job: UpdateContainerApps
    displayName: 'Update Azure Container Apps Environment Variables'
    dependsOn: FetchKeyVaultSecrets
    # pool:
    #   vmImage: 'ubuntu-latest'
    steps:
    - script: |
        az containerapp update -n callmindtestcontainer -g v2devops-new -v CONTAINER2_URL=$(Container2Url)
      displayName: 'Update Azure Container Apps'


      # az webapp config appsettings set --name 'callmindtestcontainer' --resource-group 'v2devops-new' --settings 'CONTAINER2_URL=$(Container2Url)'
      #   az webapp config appsettings set --name 'callmindtestcontainer' --resource-group 'v2devops-new' --settings 'CONTAINER1_URL=$(Container1Url)'